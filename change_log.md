[15/12/2025 14:10] - src/components/analysis/AnalysisDecisaoReposicaoView.tsx - Timeline de Risco Evolu√≠da: (1) Barra de evolu√ß√£o de risco com gradiente verde/amarelo/vermelho baseada no score; (2) Insight da LLM integrado na timeline (resumo executivo); (3) Marco de eventos "√öltima Observa√ß√£o" com observa√ß√µes de lote relevantes; (4) Cores din√¢micas por n√≠vel de risco em cada marco (üü¢ Baixo, üü° Moderado, üî¥ Alto); (5) Proje√ß√µes +30/+60 dias com descri√ß√µes contextuais baseadas no score; (6) Legenda visual de n√≠veis de risco - Cascade

[15/12/2025 14:00] - src/services/llm.ts / src/components/analysis/AnalysisDecisaoReposicaoView.tsx - Corre√ß√£o de Inconsist√™ncia LLM: (1) CORRIGIDO: campo `media_prod` agora usa `producao6m.ref_produtividade.media_geral` (produtividade real em kg/h) em vez de `produtividade_score` (score 0-100); (2) Prompt LLM reestruturado com fontes de dados claras, per√≠odos definidos, hist√≥rico mensal de produ√ß√£o e status de produtividade pr√©-calculado; (3) Instru√ß√µes espec√≠ficas para LLM citar n√∫meros e evitar contradi√ß√µes; (4) Implementada chamada real √† LLM externa (OpenRouter/Groq/Google/OpenAI) com fallback local - Cascade

[15/12/2025 13:35] - db / src/components/analysis/AnalysisDecisaoReposicaoView.tsx - Tabela llm_config no Supabase: (1) Nova tabela `llm_config` com colunas user_id, provider, openrouter_key, google_key, groq_key, openai_key; (2) RLS habilitado - usu√°rio s√≥ acessa suas pr√≥prias configura√ß√µes; (3) Trigger para atualizar updated_at automaticamente; (4) Frontend atualizado para salvar/carregar do Supabase em vez de localStorage - Cascade

[15/12/2025 13:30] - src/components/analysis/AnalysisDecisaoReposicaoView.tsx - Modal de Configura√ß√£o LLM: (1) Bot√£o de engrenagem ao lado dos bot√µes "Ranking do Dia" e "Gerar Parecer"; (2) Modal com sele√ß√£o de provider preferido (OpenRouter/Groq/Google/OpenAI); (3) Campos para API keys de cada provider com toggle mostrar/ocultar; (4) Configura√ß√µes salvas no localStorage do navegador; (5) Fallback autom√°tico entre providers - Cascade

[15/12/2025 13:25] - src/types/llm.ts / src/services/llm.ts / src/components/analysis/AnalysisDecisaoReposicaoView.tsx - An√°lise de Produ√ß√£o no Parecer LLM: (1) Novo campo `producao_6m` no contexto com hist√≥rico mensal, observa√ß√µes de lote, ligas utilizadas e refer√™ncias de produtividade (1.000-1.300 kg/h); (2) Busca autom√°tica de dados de produ√ß√£o dos √∫ltimos 6 meses via RPC `get_productivity_stats` e tabela `analysis_producao`; (3) An√°lise de produtividade vs objetivos, efici√™ncia, tend√™ncia e observa√ß√µes de lote relevantes (problema, defeito, parada, trinca, desgaste); (4) Nova se√ß√£o "An√°lise de Produ√ß√£o (6 meses)" no modal de parecer com m√©dia geral, % acima objetivo, hist√≥rico mensal, ligas e observa√ß√µes de lote - Cascade

[15/12/2025 13:10] - src/types/llm.ts / src/services/llm.ts / src/components/analysis/AnalysisDecisaoReposicaoView.tsx / supabase/functions/llm-parecer/index.ts - Integra√ß√£o LLM para Parecer de Matrizes: (1) Tipos TypeScript para contratos JSON (MatrizContexto, ParecerData, RankingData); (2) Servi√ßo frontend com fun√ß√µes gerarParecerLocal/gerarRankingLocal (fallback local quando Edge Function indispon√≠vel); (3) Edge Function Supabase com dual provider (OpenRouter/Google/Groq/OpenAI) e fallback autom√°tico; (4) UI com bot√µes "Gerar Parecer" (matriz selecionada) e "Ranking do Dia" (Top 50); (5) Modais visuais para exibi√ß√£o de recomenda√ß√£o, resumo, motivos, riscos, a√ß√µes e limita√ß√µes - Cascade

[15/12/2025 10:15] - src/components/analysis/AnalysisDecisaoReposicaoView.tsx / src/components/AnalysisView.tsx / specs.md / change_log.md - Nova sub-aba "Decis√£o de Reposi√ß√£o de Matrizes": Painel decis√≥rio inteligente com Score √önico (0‚Äì100) combinando Vida (40%), Demanda (30%), Desempenho (20%), Operacional (10%); Status autom√°tico (Confeccionar ‚â•70 / Planejar 40‚Äì69 / OK <40); Interface em 2 pain√©is (lista + detalhe); 3 abas (Decis√£o com hero card + diagn√≥stico visual + motivos + timeline com lead time 20 dias + a√ß√µes; Sequ√™ncias com an√°lise por seq; Simulador "E se‚Ä¶" com controles para demanda/seq/desgaste); Integra√ß√£o com RPCs (matrix_lifespan_summary, matrix_lifespan_by_sequence, analysis_carteira_flat_agg, get_productivity_stats); Motivos audit√°veis (crescimento %, cobertura, desgaste, seq insuficientes, EOL) - Cascade
[12/12/2025 16:10] - src/components/analysis/AnalysisVidaView.tsx - An√°lises Estrat√©gicas Avan√ßadas: (1) Score de Risco Composto (0-100) combinando cobertura, desgaste, demanda e single-seq; (2) Sala de Guerra com Top 10 matrizes cr√≠ticas ranqueadas; (3) Previs√£o de Gargalos (30/60/90 dias); (4) Single Point of Failure (matrizes vulner√°veis com 1 seq); (5) Distribui√ß√£o de Capacidade por faixa de risco; (6) Plano de A√ß√£o Recomendado com a√ß√µes urgentes, redund√¢ncia e inspe√ß√£o - Cascade
[12/12/2025 15:51] - src/components/analysis/AnalysisVidaView.tsx / AnalysisNecessidadesView.tsx - Moderniza√ß√£o das abas Vida e Necessidades com pain√©is gerenciais inteligentes: (1) KPIs estrat√©gicos (cr√≠ticas, aten√ß√£o, saud√°veis, EOL 30d, seq. ativas, utiliza√ß√£o); (2) Insights autom√°ticos com alertas de ruptura, cobertura baixa, demanda crescente e sequ√™ncias insuficientes; (3) A√ß√µes recomendadas (confeccionar, ampliar capacidade, revisar planejamento); (4) UI moderna com cards coloridos e indicadores visuais - Cascade
[28/11/2025 12:37] - src/components/analysis/AnalysisProdutividadeView.tsx / src/utils/productivityAnalysis.ts / docs/* - Implementada an√°lise completa de produtividade com gr√°ficos interativos (linha, barras, pizza); criada documenta√ß√£o completa para planejamento mobile-first (8 documentos); melhorias de responsividade no LoginDialog e Index.tsx - Cascade
[25/11/2025 13:03] - db - Aplicada migra√ß√£o para adicionar a coluna `test_status` na tabela `events`; documenta√ß√£o atualizada em `database_schema.md`; corre√ß√£o do erro PGRST204 ("Could not find the 'test_status' column of 'events' in the schema cache") - Cascade
[13/11/2025 15:07] - database_schema.md / specs.md / README.md - Documenta√ß√£o atualizada: tabela `analysis_ferramentas`, RPCs de truncate (produ√ß√£o e ferramentas) e instru√ß√µes de upload; se√ß√£o de upload por aba e mapeamento de colunas - Cascade
[13/11/2025 15:06] - data_schema.sql - Criada RPC `public.analysis_ferramentas_truncate()` (SECURITY DEFINER) com GRANT para anon/authenticated e bloco de rollback; notifica√ß√£o `pgrst reload schema` - Cascade
[13/11/2025 15:05] - src/components/analysis/AnalysisFerramentasView.tsx - Adicionado √≠cone de upload e fluxo de importa√ß√£o (XLSX/XLS/CSV) com truncamento antes da carga, inser√ß√£o em lotes, barra de progresso e recarga autom√°tica - Cascade
[14/11/2025 11:40] - src/components/analysis (Carteira/Vida) / database_schema.md / change_log.md - Lookup de "√öltimo Pedido" migrado para a VIEW `analysis_carteira_last_implant` com chaves normalizadas; corre√ß√£o de normaliza√ß√£o na aba Vida; documenta√ß√£o da VIEW e √≠ndices auxiliares registrada - Cascade
[14/11/2025 11:58] - data_schema.sql - Corre√ß√£o cr√≠tica: adicionada cria√ß√£o da tabela `analysis_carteira_flat` e RPC `analysis_carteira_flat_truncate()` que estavam faltando antes da VIEW e √≠ndices; ajuste da migra√ß√£o completa no bloco BEGIN/COMMIT - Cascade
[14/11/2025 12:30] - src/components/analysis/FerramentaAnalysisDialog.tsx - Ajuste na An√°lise de Extremes: passa a considerar apenas produ√ß√µes com volume ‚â• 200 kg para calcular menor produtividade e volume associado; descri√ß√£o atualizada no rodap√© do di√°logo - Cascade
[14/11/2025 13:35] - src/components/AnalysisView.tsx / src/components/analysis - Modal de An√°lise de Ferramenta migrado para aba dedicada em `AnalysisView`, com navega√ß√£o via bot√£o "Analisar Ferramenta" na aba Produ√ß√£o e bot√£o "Voltar para Produ√ß√£o" na aba de an√°lise; adicionados gr√°ficos de produtividade (12 meses, linhas de objetivo 1.300/1.000 kg/h) e de entradas de pedido da carteira, com tooltip exibindo sequ√™ncia apenas na linha de produtividade - Cascade
[14/11/2025 13:37] - src/components/analysis/KeywordsManagerDialog.tsx - Bot√£o "Adicionar Todas" do Gerenciador de Palavras-Chave passou a remover duplicatas dentro do pr√≥prio lote e ignorar palavras j√° existentes em `analysis_keywords`, preservando os registros atuais - Cascade
[13/11/2025 14:45] - src/components/AnalysisView.tsx - Abas compactas com scroll horizontal (overflow-x) e r√≥tulos curtos para evitar sobreposi√ß√£o - Cascade
[23/10/2025 08:15] - migrations/20241023_add_observations_and_attachments.sql - Adicionado suporte a anexos e observa√ß√µes em registros de confec√ß√£o: (1) Nova coluna 'observacoes' (texto) para notas adicionais; (2) Nova coluna 'anexos' (JSONB) para armazenar arquivos PDF/imagems; (3) Atualiza√ß√£o da documenta√ß√£o em database_schema.md; (4) Script de migra√ß√£o com rollback - Cascade

[23/10/2025 17:46] - docs - Documenta√ß√£o do workflow de confec√ß√£o atualizada (prioridades, datas estimadas, timestamps de transi√ß√£o e anexos) em `database_schema.md`, `specs.md` e `README.md` - Cascade

[24/10/2025 08:22] - src/components/AnalysisView.tsx - Adicionado √≠cone discreto na aba An√°lise abrindo di√°logo para anexar at√© quatro planilhas Excel (Produ√ß√£o, Carteira, Ferramentas, Corre√ß√µes) com hist√≥rico local de uploads - Cascade

[24/10/2025 08:39] - db - Criada tabela `analysis_excel_uploads` para armazenar a vers√£o mais recente das planilhas de Produ√ß√£o, Carteira, Ferramentas e Corre√ß√µes (migr. 20251024_add_analysis_excel_uploads) - Cascade

[24/10/2025 08:44] - src/components/AnalysisView.tsx / src/services/analysis.ts - Uploads da aba An√°lise integrados com Supabase Storage + metadados em `analysis_excel_uploads` (sobrescrita controlada, download e limpeza por categoria) - Cascade

[24/10/2025 08:52] - db/ui - Tabela `analysis_excel_uploads` passou a registrar `has_header`/`header_row` (cabe√ßalhos na primeira linha) e √°rea An√°lise exibe apenas instru√ß√µes; uploads seguem via modal - Cascade

[20/10/2025 12:06] - src/components/ManufacturingView.tsx - Sistema de workflow com TR√äS abas (Necessidade, Solicita√ß√£o, Em Fabrica√ß√£o): Fluxo progressivo - (1) Necessidade (need): matrizes rec√©m-registradas, bot√£o azul para mover para Solicita√ß√£o; (2) Solicita√ß√£o (pending): processo interno/OCs, bot√£o verde para aprovar fabrica√ß√£o; (3) Em Fabrica√ß√£o (approved): matriz no fornecedor sendo fabricada, dispon√≠vel para sele√ß√£o na Timeline; cores distintivas (vermelho/amber/verde); √≠cones AlertCircle/Clock/CheckCircle2; fun√ß√£o moveToSolicitation() criada; migra√ß√£o com 4 status (need/pending/approved/received); documenta√ß√£o completa atualizada - Cascade

[06/10/2025 07:29] - extrude-flow-main - Sino de Notifica√ß√µes com sele√ß√£o por categorias (Aprovadas, Limpeza, Corre√ß√£o Externa) e envio por e-mail via mailto; integra√ß√£o em `src/pages/Index.tsx`; novo componente `src/components/NotificationsBell.tsx`; `.env.example` atualizado com `VITE_NOTIFY_GROUP_EMAILS`; documenta√ß√£o em `specs.md` - Cascade
[03/10/2025 10:12] - extrude-flow-main - Nova aba funcional: "Ferramentas Aprovadas" com agrupamento por Ano/M√™s em `src/components/ApprovedToolsView.tsx` e integra√ß√£o no `Index.tsx` - Cascade

[03/10/2025 10:34] - extrude-flow-main - Dashboard: indicadores de lead por pasta e aprova√ß√µes por n¬∫ de testes (geral e por pasta); Index: aprovadas ocultas na Sidebar, Timeline e Planilha - Cascade

[02/10/2025 10:11] - extrude-flow-main - Itera√ß√£o 1: Status atual na sidebar, prioridade e respons√°vel em formul√°rios, indicadores por matriz, tradu√ß√£o PT-BR do 404, specs.md criado - Cascade

[02/10/2025 14:02] - extrude-flow-main - Cria√ß√£o do esquema Supabase: data_schema.sql com tabelas (folders, matrices, events com subeventos, event_files), √≠ndices, RLS e rollback; documenta√ß√£o em database_schema.md - Cascade

[07/10/2025 07:33] - extrude-flow-main - UI: Painel direito (cart√µes) mais estreito em `src/pages/Index.tsx` e redu√ß√£o do espa√ßo entre t√≠tulo e √≠cone em `src/components/CollapsibleCard.tsx` - Cascade

[07/10/2025 07:35] - extrude-flow-main - Removido/Desabilitado o bloco "Relat√≥rio de Log" de `src/components/ImportExport.tsx` (UI, estados, fun√ß√µes e imports); mantidas apenas a√ß√µes de Importar/Exportar Excel - Cascade

[15/10/2025 12:26] - extrude-flow-main - Corre√ß√£o l√≥gica de teste ativo: matrizes com eventos posteriores ao √∫ltimo "Testes" s√£o consideradas dispon√≠veis para novo planejamento; UI: bot√£o Atualizar trocado por √≠cone, removido contador de matrizes da barra superior - Cascade

[15/10/2025 12:48] - extrude-flow-main - Edi√ß√£o de itens da fila: campo images (JSONB) adicionado √† testing_queue; cards da fila clic√°veis para editar observa√ß√£o e imagens; di√°logo de edi√ß√£o com upload m√∫ltiplo e lightbox; corre√ß√µes em sidebar (tipo "Testes" nos indicadores e status); clique em cards de teste ativo habilitado - Cascade

[15/10/2025 13:54] - extrude-flow-main - Nova aba Confec√ß√£o: ponto de partida do processo com formul√°rio completo (tipo confec√ß√£o, perfil, fornecedor, prazo, fotos matriz/problemas, observa√ß√µes t√©cnicas, justificativa); tabela manufacturing_records criada; ao registrar confec√ß√£o, matriz √© criada automaticamente com evento Recebimento e aparece em Timeline/Planilha; design inovador com cards coloridos e upload de imagens com lightbox - Cascade

[15/10/2025 20:15] - src/components - Timeline/Planilha: corre√ß√£o de fuso nas datas; Timeline com formatador est√°vel; Planilha mais compacta (menos espa√ßamento e inputs de data ajustados). Conclus√£o de teste agora atualiza o √∫ltimo evento 'Testes' e Planilha conta apenas testes conclu√≠dos - Cascade

[15/10/2025 20:28] - src/components - Kanban: ao registrar 'Corre√ß√£o Externa Entrada' pela Planilha, atualiza√ß√£o do cart√£o autom√°tico para 'Entrada' com descri√ß√£o de retorno; servi√ßo `kanbanUpdateLatestAutoCardForMatrix` adicionado - Cascade

[15/10/2025 20:36] - src/components - UX: duplo clique para fechar painel direito e recolher menu esquerdo (√°rea vazia); ajustes no sininho de notifica√ß√µes para 'somente leitura' quando n√£o autenticado (sem selecionar/limpar/marcar/mandar e-mail) - Cascade

[15/10/2025 20:58] - src/components - Hist√≥rico: se√ß√£o 'Filtros e Controles' recolh√≠vel/expand√≠vel com bot√£o no cabe√ßalho - Cascade

[15/10/2025 21:05] - src/components - Relat√≥rio Final/Anexos: corre√ß√£o de `e.currentTarget` nulo; acessibilidade do Dialog; servi√ßo de arquivos compat√≠vel com `event_files` (mime_type, file_size) - Cascade

[16/10/2025 16:10] - db - Migra√ß√£o: adicionar coluna `test_status` em `events` (Aprovado/Reprovado) e atualizar constraint de `notifications_sent.category` para incluir "Reprovado" - Cascade
[16/10/2025 16:18] - src/components - EventDetailDialog: campo "Status do Teste" exibido para eventos `type = "Testes"`, persistindo em `events.test_status` - Cascade
[16/10/2025 16:24] - src/components - NotificationsBell: nova categoria "Reprovado"; categoriza√ß√£o via `MatrixEvent.testStatus`; migra√ß√£o autom√°tica do localStorage para incluir a categoria; e-mail usa "Cliente" em vez de "Apontado" - Cascade
[16/10/2025 16:28] - src/components - ActivityHistory: suporte √† categoria "Reprovado" nos filtros e migra√ß√£o de localStorage - Cascade
[16/10/2025 16:32] - src/components - FlowView: exibir "Cliente: <responsible>" no cabe√ßalho da matriz - Cascade
[16/10/2025 16:36] - src/components - MatrixSheet: corrigida exibi√ß√£o de data (sem fuso) e ajuste do crit√©rio de testes (lista todos os `Testes`); helper de formata√ß√£o sem timezone - Cascade
[16/10/2025 16:45] - docs - Atualiza√ß√£o de `database_schema.md` (test_status, categorias de notifica√ß√µes) e `specs.md` (Realtime, Reprovado, e-mail com Cliente, corre√ß√µes de data) - Cascade

[11/11/2025 15:10] - db - Notifica√ß√µes: cria√ß√£o/alinhamento de `public.notifications_sent` (colunas: `sent_at`, `emitter_id`, `user_agent`, `platform`, `language`; categorias incluem "Recebidas"; √≠ndices `ux_notifications_sent_event_cat` e `idx_notifications_sent_event`; RLS liberal; Realtime habilitado na publica√ß√£o `supabase_realtime`) via MCP - Cascade

[11/11/2025 15:12] - docs - Documenta√ß√£o atualizada com estado do banco e do app: `database_schema.md` (notifications_sent alinhada), `README.md` (Backup/Snapshot e checklist de notifica√ß√µes), `specs.md` (Itera√ß√£o 11/11/2025 - Persist√™ncia reativada). Criado snapshot em `docs/snapshots/2025-11-11_supabase_snapshot.md` - Cascade

[12/11/2025 11:12] - db - Criado RPC `public.analysis_producao_truncate()` (SECURITY DEFINER) e integrado no frontend da aba An√°lise/Produ√ß√£o para sobrescrita total antes de novo upload; documentado `produced_on` + trigger + √≠ndice em `database_schema.md` e specs atualizadas - Cascade

[12/11/2025 15:00] - src/components/analysis - Carteira: Layout da tabela padronizado com Produ√ß√£o (removido Card wrapper, tabela HTML nativa com Tailwind, cabe√ßalho sticky, hover em linhas); rodap√© com estat√≠sticas (registros exibidos, volume total em kg e toneladas, distribui√ß√£o ABC); imports desnecess√°rios removidos - Cascade

[12/11/2025 15:10] - src/components/analysis - Carteira: Corre√ß√£o cr√≠tica de agrega√ß√£o - normaliza√ß√£o case-insensitive para agrupar varia√ß√µes de ferramentas (tr-0100, TR-0100, Tr-0100); preserva√ß√£o do nome original para exibi√ß√£o; contador de registros por ferramenta; logs detalhados de debug (registros carregados, agrega√ß√£o antes/depois) - Cascade

[12/11/2025 15:12] - src/components/analysis - Carteira: Ajustes de filtros padr√£o (per√≠odo iniciando em 01/01/2024 ao inv√©s de 12 meses, tipo "Todos" ao inv√©s de "Produ√ß√£o"); limite de registros aumentado de 20k para 100k; parseNumberBR melhorado (remo√ß√£o de espa√ßos); rodap√© exibe totais em kg e toneladas + contador de registros - Cascade
